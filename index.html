<!DOCTYPE html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width,
initial-scale=1">
<script data-goatcounter="https://hardmath123.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
<script>

  var model_num_guesses = {}
  var model_num_winners = {}
</script>

<title>Shabdle: Wordle in Hindi</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Laila:wght@400;700&display=swap');

body {
  width: 100%;
  max-width: 35em;
  margin-right: auto;
  margin-left: auto;
  margin-bottom: 0;
  margin-top: 0;
  padding-left: 0.5em;
  padding-right: 0.5em;

  font-family: Palatino,
  sans-serif;
  color: black;
  background: white;
  box-sizing: border-box;
}

textarea {
  font-family: serif;
  resize: none;
  display:  block;
  margin-left: auto;
  margin-right: auto;
}

td {
  width: 2.5em;
  height: 2.5em;
  text-align: center;
  background: white;
  border: 1px solid black;
}
td[data-guess]:not([data-guess=""]) {
  background: #ddd;
}
td.good {
  background: rgb(133,
    166,
  117) !important;
  color: white;
  border: none;
}
td.bad {
  background: rgb(244,
    102,
  102) !important;
  color: white;
  border: none;
}
td.okay {
  background: rgb(226,
    160,
  39) !important;
  color: white;
  border: none;
}
td.invalid {
  background: black !important;
  color: white;
  border: none;
}
table {
  font-size: 1.5em;
  font-family: 'Laila';
  margin-left: auto;
  margin-right: auto;
  margin-bottom: 1em;
}

#keyboard {
  font-family: 'Laila';
  text-align: center;
  -webkit-user-select:none;
  font-size: 1.2em;
}
#keyboard span {
  display: inline-block;
  width: 2em;
  text-align: center;
  margin: 0.1em;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  background: hsl(0,
    10%,
  90%);
  cursor: pointer;
  border-radius: 0.3em;
}
#keyboard span#delete {
  width: 8em;
}
#keyboard span:nth-child(odd) {
  background: hsl(60,
    10%,
  90%);
}
#keyboard span:hover {
  background: black;
  color: white;
}
#keyboard span.good {
  background: rgb(133,
    166,
  117);
  color: white;
}
#keyboard span.bad {
  background: rgb(244,
    102,
  102);
  color: white;
}
#keyboard span.okay {
  background: rgb(226,
    160,
  39);
  color: white;
}

#share-area {
  margin-bottom:  1em;
}
#countdown {
  font-weight: bolder;
}

#bars div {
  background: lightgray;
  overflow: visible;
  white-space: nowrap;
  padding:  0.2em;
  font-size: 0.8em;
}

header {
  color: darkred;
}
h2 {
  text-align: right;
}
footer {
  margin-top: 5em;
  font-size: 0.8em;
  background: #fee;
  padding:  0.5em;
  border-top-left-radius: 1em;
  border-top-right-radius: 1em;
}

details {
  background: #eee;
  padding: 0.5em;
  margin-bottom: 1em;
}
</style>

<script>
var wl = [];
var wl_curated = [];
var rows = [];
var puzzle = null;
var now_utc = new Date();
var todays_utc_date = now_utc.getUTCFullYear() + '-' + (now_utc.getUTCMonth() + 1) + '-' + now_utc.getUTCDate();
var who = localStorage.getItem('who') || (Date.now() + "-" + Math.floor(Math.random() * (1 << 24)));

function log_to_sqlite(guess,
  count) {
  data = {
    date: todays_utc_date,
    time: Date.now(),
    who: who,
    guess: guess,
    count: count
  };
  var xhr = new XMLHttpRequest();
  xhr.open('GET',
    'https://cors.bridged.cc/' + 'http://128.52.141.81:8081/' + encodeURIComponent(JSON.stringify(data)));
  xhr.send(null);
}

var AKSHAR_AADHA = 0;
var AKSHAR_POORA = 1;
var AKSHAR_MATRA = 2;
function classify_akshar(word,
  i) {
  var cc = word.charCodeAt(i);
  if (cc >= 0x0900 && cc <= 0x0903) return AKSHAR_MATRA;
  if (cc >= 0x093A && cc <= 0x0957) return AKSHAR_MATRA;
  if (i == word.length - 1) return AKSHAR_POORA;
  if (word.charCodeAt(i + 1) == 0x094d) return AKSHAR_AADHA;
  return AKSHAR_POORA;
}


var key_map = {};  // maps akshars to <span> elements
function make_keyboard() {
  var keyboard = document.getElementById("keyboard");
  var c_fst = 0x0905;
  var c_end = 0x0939 + 1;
  var k = 0;
  for (var i = 0; i < c_end - c_fst; i++) {
    if ([
	0x090c,
	0x090d,
    0x090e,
    0x0911,
    0x0912,
    0x0929,
    0x0931,
    0x0934].indexOf(c_fst + i) !== -1) continue;
    k++;
    if (
      k == 7 || k == 12 ||
      k > 12 && k < 42 && (k - 12) % 5 == 0 || k == 42
    ) keyboard.appendChild(document.createElement('br'));

    var key = document.createElement('span');
    key.textContent = String.fromCharCode(c_fst + i);
    key_map[key.textContent] = key;
    key.addEventListener('click',
      function(e) {
      var row = rows[rows.length - 1];
      for (var j = 0; j < row.length; j++) if (row[j].dataset.guess == '') break;
      row[j].dataset.guess = e.target.textContent;
      render_rows();
    });
    keyboard.appendChild(key);
  }
  keyboard.appendChild(document.createElement('br'));
  var backspace = document.createElement('span');
  backspace.id = "delete";
  backspace.textContent = "‚Üê";
  backspace.addEventListener('click',
    function(e) {
    var row = rows[rows.length - 1];
    for (var j = 0; j < row.length; j++) if (row[j].dataset.guess == '') break;
    if (j > 0 && j !== row.length) row[j - 1].dataset.guess = '';
    render_rows();
  });
  keyboard.appendChild(backspace);
}

function seededRandom(seedString) {
  // 1. Simple hash of the string to create a numeric seed
  let seed = 0;
  for (let i = 0; i < seedString.length; i++) {
    seed = (seed << 5) - seed + seedString.charCodeAt(i);
    seed |= 0; // Convert to 32bit integer
  }

  // 2. LCG algorithm (Mulberry32 is a fast, popular choice for JS)
  return function() {
    seed |= 0; 
    seed = (seed + 0x6D2B79F5) | 0;
    let t = Math.imul(seed ^ (seed >>> 15), 1 | seed);
    t = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}

function puzzles(dateString) {
  // Initialize the generator
  const rng = seededRandom(dateString);

  // Sample an element
  function getSample(array, randomFunc) {
    const randomIndex = Math.floor(randomFunc() * array.length);
    return array[randomIndex];
  }

  return getSample(wl_curated, rng);
}

function add_row() {
  var tr = document.createElement('tr');
  var row = [];
  for (var i = 0; i < puzzle.length; i++) {
    var td = document.createElement('td');
    td.dataset.guess = '';
    tr.appendChild(td);
    row.push(td);
  }
  document.getElementById('grid').appendChild(tr);
  rows.push(row);

  render_rows();
}


function score_row(row) {
  var guess = '';
  for (var i = 0; i < row.length; i++) {
    guess += puzzle[i].pre + row[i].dataset.guess + puzzle[i].post;
  }
  log_to_sqlite(guess,
    rows.length);
  if (guess !== puzzles(todays_utc_date) && wl.indexOf(guess) == -1) {
    for (var i = 0; i < row.length; i++) row[i].className = 'invalid';
    add_row();
    return;
  }
  var win = true;
  var total_count = {};  // number of "unclaimed" letters
  for (var i = 0; i < puzzle.length; i++) {
    if (!Object.hasOwnProperty(total_count,
      puzzle[i].mid))
      total_count[puzzle[i].mid] = 0;
    if (row[i].dataset.guess != puzzle[i].mid)
      total_count[puzzle[i].mid]++;
  }
  for (var i = 0; i < row.length; i++) {
    if (row[i].dataset.guess == puzzle[i].mid) {
      row[i].className = 'good';
      key_map[row[i].dataset.guess].className = 'okay';
    } else {
      win = false;
      row[i].className = 'bad';
      if (total_count[row[i].dataset.guess] > 0) {
        row[i].className = 'okay';
        total_count[row[i].dataset.guess]--;
        key_map[row[i].dataset.guess].className = 'okay';
      }
      if (!Object.hasOwnProperty(total_count,
        row[i].dataset.guess)) {
        key_map[row[i].dataset.guess].className = 'bad';
      }
    }
  }

  if (win) make_share();
  else add_row();
}


function render_rows() {
  for (var i = 0; i < rows.length; i++) render_row(rows[i],
    puzzle);

  var row = rows[rows.length - 1];
  var all_guessed = true;
  for (var i = 0; i < row.length; i++)
    if (row[i].dataset.guess == '') all_guessed = false;
  if (all_guessed) score_row(row);
}


function render_row(row,
  puzzle) {
  for (var i = 0; i < puzzle.length; i++) {
    var out = '';
    if (/*puzzle[i].post == '' && */row[i].dataset.guess == '') {
      out = puzzle[i].pre + dotted_circle + puzzle[i].post;
    } else {
      out = puzzle[i].pre + row[i].dataset.guess + puzzle[i].post;
    }
    row[i].textContent = out;
  }
}


function make_share() {
  var tags = {
    'good': 'üü¢',
    'bad': 'üî¥',
    'okay': 'üü°',
    'invalid': '‚ö´'
  }
  var out = "My Shabdle scorecard on " + todays_utc_date + ":\n";
  out += "\nSolved in " + rows.length + " attempt[s].\n\n";
  for (var i = 0; i < rows.length; i++) {
    for (var j = 0; j < rows[i].length; j++) {
      out += tags[rows[i][j].className];
    }
    out += '\n';
  }
  out += 'https://frommak.github.io/shabdle/'
  var share = document.getElementById('share');
  share.value = out;
  document.getElementById('tweet-link').href = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(out);
  document.getElementById('whatsapp-link').href = "https://wa.me/?text=" + encodeURIComponent(out.replace(/\n/g,
    ' | '));

  document.getElementById('share-area').style.display = 'block';
  share.focus();
  share.select();
  document.getElementById('keyboard').style.display = 'none';

  var hours_left = 23 - new Date().getUTCHours();
  var minutes_left = 59 - new Date().getUTCMinutes();
  document.getElementById('countdown').textContent = hours_left + ' hours and ' + minutes_left + ' minutes';


  var scores_hist = {};
  function make_bar(n) {
    if (n === rows.length || n == 6 && rows.length >= 6) {
      path = "hit";
    }
    else {
      path = "get";
    }
    var url = "https://api.countapi.xyz/" + path + "/shabdle-" + todays_utc_date + "-" + n;
    var xhr = new XMLHttpRequest();
    xhr.open("GET",
      url);
    xhr.responseType = "json";
    xhr.onloadend = function() {
      if (xhr.status == 404) {
        scores_hist[n] = 0;
      } else {
        scores_hist[n] = this.response.value;
      }
      if (Object.keys(scores_hist).length === 6) {
        var total = 0;
        for (var i = 1; i <= 6; i++) total += scores_hist[i];
        for (var i = 1; i <= 6; i++) {
          document.getElementById('bar-' + i + '-bar').style.width = scores_hist[i] / total * 100 + '%';
          document.getElementById('bar-' + i + '-bar').textContent = (i == 6 ? '6+' : i) + ' guesses: ' + scores_hist[i] + ' players';
          if (i == rows.length)
            document.getElementById('bar-' + i + '-bar').style.backgroundColor = 'gray';
        }
      }
    };
    xhr.onerror = function(e) {
      scores_hist[n] = 0;
    };
    xhr.send();
  }
  for (var n = 1; n <= 6; n++) make_bar(n);

}


window.addEventListener('load', 
  async function() {
	  make_keyboard();

	  try {
		  const response = await fetch('./mr_curated_test.wl');
		  if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
		  const fullText = await response.text();
		  wl_curated = fullText.split('\n');
		} catch (error) {
		console.error("Fetch failed:", error);
	  }  

	  var yesterday = new Date(now_utc);
	  yesterday.setDate(yesterday.getDate() - 1)
	  yesterday = yesterday.getUTCFullYear() + '-' + (yesterday.getUTCMonth() + 1) + '-' + yesterday.getUTCDate();
	  document.getElementById('yesterday').textContent = puzzles(yesterday);
	  // todays_utc_date = '2026-12-17';



	  var xhr = new XMLHttpRequest();
	  xhr.open('GET',
		'./mr.wl');
	  xhr.onload = function(x) {
		wl = this.responseText.split('\n');
		var word = puzzles(todays_utc_date);

		if (model_num_guesses.hasOwnProperty(word) && model_num_winners.hasOwnProperty(word)) {
		  document.getElementById('model').style.display = 'block';
		  document.getElementById('model_num_guesses').textContent = model_num_guesses[word];
		  document.getElementById('model_num_winners').textContent = model_num_winners[word];
		}

		puzzle = [];

		var row = [];
		var needs_new = false;
		for (var i = 0; i < word.length; i++) {
		  var c = classify_akshar(word,
			i);

		  if (i == 0 || (c != AKSHAR_MATRA && needs_new)) {
			if (classify_akshar(word,
			  i - 1) == AKSHAR_POORA) row[row.length - 1] += dotted_circle;
			row.push('');
			puzzle.push({pre: '',
			  post: '',
			mid: ''});
		  }
		  if (c == AKSHAR_MATRA) {
			row[row.length - 1] += word.charAt(i);
			if (word.charCodeAt(i) == 0x094d)
			  puzzle[puzzle.length - 1].pre += word.charAt(i);
			else
			  puzzle[puzzle.length - 1].post += word.charAt(i);
		  }
		  if (c == AKSHAR_AADHA) {
			row[row.length - 1] += word.charAt(i);
			puzzle[puzzle.length - 1].pre += word.charAt(i);
		  }
		  if (c == AKSHAR_POORA) {
			puzzle[puzzle.length - 1].mid = word.charAt(i);
		  }

		  if (c == AKSHAR_POORA || (c == AKSHAR_MATRA && word.charCodeAt(i) != 0x094d))
			needs_new = true;
		  else
			needs_new = false;
		}
		add_row();
	  };
	  xhr.send(null);
	},
	false);
var dotted_circle = '\u25cc';
</script>



<header>
<h1>Shabdle: Wordle in Marathi</h1>
<h2>‡§∂‡§¨‡•ç‡§¶‡§≤ &mdash; ‡§µ‡§∞‡•ç‡§°‡§≤ ‡§Æ‡§∞‡§æ‡§†‡•Ä‡§Æ‡§ß‡•ç‡§Ø‡•á</h2>
</header>

<details open id="instructions" name="How to play">
  <summary>How to play / ‡§ï‡§∏‡•á ‡§ñ‡•á‡§≥‡§æ‡§Ø‡§ö‡•á</summary>
  <p>Use the keyboard below to guess the missing letters in the hidden word. There is a new puzzle every day: the hidden word changes overnight.

  <p>‡§ï‡•Ä‡§¨‡•ã‡§∞‡•ç‡§° ‡§µ‡§æ‡§™‡§∞‡•Ç‡§® ‡§≤‡§™‡§≤‡•á‡§≤‡•ç‡§Ø‡§æ ‡§∂‡§¨‡•ç‡§¶‡§æ‡§§‡•Ä‡§≤ ‡§ó‡§π‡§æ‡§≥ ‡§Ö‡§ï‡•ç‡§∑‡§∞‡•á ‡§∂‡•ã‡§ß‡§æ. ‡§¶‡§∞‡§∞‡•ã‡§ú ‡§è‡§ï ‡§®‡§µ‡•Ä‡§® ‡§ï‡•ã‡§°‡•á &mdash; ‡§≤‡§™‡§≤‡•á‡§≤‡§æ ‡§∂‡§¨‡•ç‡§¶ ‡§∞‡§æ‡§§‡•ç‡§∞‡•Ä ‡§¨‡§¶‡§≤‡§§‡•ã.

  <p>
  üü¢ = correct letter = ‡§¨‡§∞‡•ã‡§¨‡§∞ ‡§Ö‡§ï‡•ç‡§∑‡§∞<br/>
  üî¥ = letter not in word = ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§∂‡§¨‡•ç‡§¶‡§æ‡§§ ‡§®‡§æ‡§π‡•Ä<br>
  üü° = letter elsewhere in word = ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§∂‡§¨‡•ç‡§¶‡§æ‡§§ ‡§¶‡•Å‡§∏‡§∞‡•Ä‡§ï‡§°‡•á ‡§ï‡•Å‡§†‡•á‡§§‡§∞‡•Ä ‡§Ü‡§π‡•á<br/>
  ‚ö´ = word not in dictionary = ‡§Ü‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§∂‡§¨‡•ç‡§¶‡§ï‡•ã‡§∂‡§æ‡§§ ‡§π‡§æ ‡§∂‡§¨‡•ç‡§¶ ‡§∏‡§æ‡§™‡§°‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä<br/>
  </p>
</details>

<details>
  <summary>Yesterday's solution / ‡§ï‡§æ‡§≤‡§ö‡§æ ‡§∂‡§¨‡•ç‡§¶ ‡§ï‡§æ‡§Ø ‡§π‡•ã‡§§‡§æ?</summary>
  <p id="yesterday"></p>
</details>

<details id="model" style='display: none;' open>
  <summary>Our predictions about this puzzle</summary>
  <p>Our AI model thinks that this puzzle has difficulty <span id="model_num_winners"></span>&nbsp;/&nbsp;7,
    and should take <span id="model_num_guesses"></span> guesses to solve. Can you do better?
</details>

<table id="grid">
</table>

<div id="share-area" style="display: none;">
  The next Shabdle will be released in <span id="countdown"></span>
</div>

<div id="keyboard">
</div>

<footer>Marathi Shabdle is inspired by <a
href="https://github.com/kach/shabdle">Hindi Shabdle</a> which is inspired by <a
href="https://www.powerlanguage.co.uk/wordle/">Wordle</a>.
</footer>
